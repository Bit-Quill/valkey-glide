name: Lint rust

inputs:
    cargo-toml-folder:
        description: "folder that contains the target Cargo.toml file"
        required: true
        type: string

runs:
    using: "composite"

    steps:
        - uses: actions/checkout@v4
          with:
              submodules: recursive

        - uses: dtolnay/rust-toolchain@stable
        - uses: Swatinem/rust-cache@v2

        - run: |
              sudo apt update
              sudo apt install protobuf-compiler
          shell: bash

        - run: cargo fmt --manifest-path ${{ inputs.cargo-toml-folder }}/Cargo.toml --all -- --check
          shell: bash

        - run: cargo clippy --manifest-path ${{ inputs.cargo-toml-folder }}/Cargo.toml --all-features --all-targets -- -D warnings
          shell: bash

        - run: |
              cd ${{ inputs.cargo-toml-folder }}
              cargo update
              cargo install cargo-deny
              cargo deny check licenses --config ${GITHUB_WORKSPACE}/deny.toml
          shell: bash

        - name: doc
          shell: bash
          working-directory: ${{ inputs.cargo-toml-folder }}
          run: cargo doc --no-deps --document-private-items
          env:
              RUSTDOCFLAGS: -Dwarnings
